# memory/2026-02-27 — 작업 로그

- 시간: 2026-02-27 (Asia/Seoul)
- 핵심 작업:
  - Soft Paper(Photobook) 테마 적용: globals.css에 테마 변수 및 카드/modal/button 스타일 추가. PhotoGrid에 .photo-card, .photo-thumb, 캡션 적용.
  - PhotoGrid의 삭제 흐름 개선: doDelete 함수 재작성(네트워크 오류, 비-JSON 응답, 상태 코드별 메시지 처리, x-vercel-id 추적 포함).
  - watcher 및 R2 진단 관련 문서 및 스크립트 정리(이미 존재하는 파일들, R2 인증 오류 계속 관찰됨).
  - preview-page 배포: preview-paper.html을 feature/alfred/gh-pages-ready 브랜치로 커밋하고 main에 병합 시도 및 Vercel 배포 확인.
  - Git 충돌/병합 정리: 여러 번의 병합/리베이스 충돌 해결 후 main에 변경 반영 시도; 일부 push 충돌이 있었음.

- 문제/블로킹:
  - /archive 클라이언트에서 "로딩 중..." 상태 유지 — 서버(/api/photos)는 정상 응답하나 클라이언트 번들 실행 또는 렌더링에서 문제 발생.
  - Cloudflare R2: ListObjectsV2/PutObject Unauthorized 오류 지속 (가능 원인: 키 유형(API Token vs S3 key), 잘못된 문자열/공백, 권한 설정).
  - Git 리포지토리 상태 복잡: 여러 브랜치와 리베이스로 인해 푸시 충돌이 발생함.

- 다음 단계(우선순위):
  1. Vercel 환경변수 확인 및 R2/SUPABASE 키 회전: R2_ACCOUNT_ID, R2_ACCESS_KEY_ID, R2_SECRET_ACCESS_KEY, R2_BUCKET, R2_PUBLIC_URL, SUPABASE_SERVICE_ROLE_KEY, NEXT_PUBLIC_SUPABASE_URL, ADMIN_PURGE_KEY 등 설정 및 배포 재실행.
  2. 클라이언트 콘솔 로그 수집: /archive에서 DevTools Console/Network 확인(스크립트 로드 상태, JS 에러) — assistant가 자동 수집 시도했으나 puppeteer 미설치로 실패.
  3. Tailwind 유틸리티 충돌 제거: PhotoGrid에서 bg-gray-... 같은 Tailwind 색상 클래스 제거하고 .photo-card 기반 스타일로 전환(이미 일부 적용).
  4. Re-run R2 diagnostics after env update; verify ListObjectsV2 and PutObject.
  5. Finish repo cleanup (git-filter-repo/BFG) after collaborator coordination.

- 처리한 soft-deleted photo IDs today:
  - ecbec73b-3d69-45f0-a27a-985d301b7d07 (DSC00292.jpeg) — soft-deleted
  - f8640c71-047b-4ba2-8b81-78e893805ecc (IMG_8111.jpg) — soft-deleted
  - 418a7737-5ba6-4586-9cee-c6b4cfc7ad44 (IMG_0982.jpeg) — soft-deleted

- 기타 참고:
  - Preview page URL: https://photo-gallery-chi-seven.vercel.app/preview-paper.html
  - Recent R2 diagnostic script path: scripts/test_r2_upload.js

